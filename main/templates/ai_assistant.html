{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sandy - AI Assistant</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(to bottom, #0d0d2b, #1e1e3f);
      overflow-x: hidden;
      font-family: 'Segoe UI', sans-serif;
    }

    canvas#space {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
    }

    .ai-card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 255, 255, 0.2);
      border-radius: 20px;
      box-shadow: 0 0 25px rgba(0, 255, 255, 0.15);
      padding: 30px;
      max-width: 500px;
      width: 100%;
    }

    .floating-img {
      border-radius: 50%;
      width: 120px;
      box-shadow: 0 0 25px cyan;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    .glass-textarea {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(0, 255, 255, 0.3);
      color: white;
      border-radius: 10px;
      padding: 10px;
      width: 100%;
      resize: none;
      font-size: 1rem;
    }

    .ai-btn {
      padding: 0.5rem 1.3rem;
      border-radius: 30px;
      font-weight: bold;
      font-size: 1rem;
      transition: 0.3s;
    }

    .ai-btn.ask {
      background: #00bcd4;
      color: white;
      box-shadow: 0 0 10px #00bcd4;
    }

    .ai-btn.speak {
      background: #4caf50;
      color: white;
      box-shadow: 0 0 10px #4caf50;
    }

    .ai-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px #00ffff;
    }

    .back-btn {
      font-weight: bold;
      color: cyan;
      border: 2px solid cyan;
      border-radius: 25px;
      padding: 0.4rem 1rem;
      box-shadow: 0 0 10px cyan;
      background: transparent;
      transition: 0.3s;
      text-decoration: none;
    }

    .back-btn:hover {
      background: rgba(0, 255, 255, 0.1);
      box-shadow: 0 0 20px cyan;
    }
  </style>
</head>
<body>

<!-- Centered Container -->
<div class="container d-flex align-items-center justify-content-center vh-100">
  <div class="ai-card text-center text-light">

    <!-- Image -->
    <img src="{% static 'img/A.png' %}" alt="AI Assistant" class="floating-img mb-3">

    <!-- Greeting -->
    <h5 class="fw-bold mb-3">üë©üèª‚ÄçüöÄ Hi, I‚Äôm <span style="color:#00ffff">Sandy</span>, your AI Assistant</h5>

    <!-- Input -->
    <textarea id="userInput" class="glass-textarea mb-3" placeholder="Ask me anything..." rows="3"></textarea>

    <!-- Buttons -->
    <div class="d-flex justify-content-center gap-3 mb-3">
      <button class="ai-btn ask" onclick="handleMessage()">üí¨ Ask</button>
      <button class="ai-btn speak" onclick="speakFromMic()">üé§ Speak</button>
    </div>

    <!-- Back -->
    <a href="{% url 'home' %}" class="back-btn">‚Üê Back to Home</a>

  </div>
</div>

<!-- Star Background -->
<canvas id="space"></canvas>

<!-- JS Scripts -->
<script>
  const canvas = document.getElementById('space');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let stars = Array.from({ length: 200 }, () => ({
  x: Math.random() * canvas.width,
  y: Math.random() * canvas.height,
  r: Math.random() * 1.5,
  d: Math.random()
}));

function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (let s of stars) {
    ctx.beginPath();
    ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
    ctx.fillStyle = "#00ffff";
    ctx.fill();
    s.y += s.d;
    if (s.y > canvas.height) s.y = 0;
  }
  requestAnimationFrame(animate);
}
animate();

// AI Assistant Logic
function speak(text, question = "") {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = 'en-GB';
  utterance.pitch = 1.3;
  utterance.rate = 1;

  // Function to set the voice and speak
  const speakWithVoice = () => {
    const voices = speechSynthesis.getVoices();
    // Prioritize specific female voices, then generic female, then any available voice
    const femaleVoice = voices.find(voice =>
      voice.name.includes("Google UK English Female") ||
      voice.name.includes("Samantha") || // macOS voice
      voice.name.includes("Zira") ||      // Windows voice
      voice.name.includes("Google US English") ||
      voice.name.toLowerCase().includes("female")
    );
    utterance.voice = femaleVoice || voices[0]; // Use found female voice or default to the first available
    speechSynthesis.speak(utterance);

    // Save conversation (assuming this endpoint is set up on your backend)
    fetch("/save-conversation/", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ question, answer: text })
    })
    .catch(error => console.error("Error saving conversation:", error));
  };

  // Check if voices are already loaded, otherwise wait for them
  if (speechSynthesis.getVoices().length === 0) {
    speechSynthesis.onvoiceschanged = speakWithVoice;
  } else {
    speakWithVoice();
  }
}

// Define URLs for redirection and resume
const resumeUrl = "{% static 'resume.pdf' %}";
const contactUrl = "{% url 'contact' %}"; // Ensure 'contact' is a valid URL name in Django
const certificatesUrl = "{% url 'certificates' %}"; // Ensure 'certification' is a valid URL name in Django
const projectsUrl = "{% url 'projects' %}";


function handleMessage() {
  const message = document.getElementById("userInput").value.trim().toLowerCase();
  if (!message) return; // Do nothing if the input is empty

  const hours = new Date().getHours(); // Get current hour for greetings

  if (message.includes("hello") || message.includes("hi")) {
    let greeting = hours < 12 ? "Good Morning!" : hours < 18 ? "Good Afternoon!" : "Good Evening!";
    speak(`${greeting} I am Sandy. How can I assist you today?`, message);

  } else if (message.includes("yourself") || message.includes("who are you")) {
    speak("I am Sandy, your AI assistant. I'm a full-stack developer skilled in HTML, CSS, JavaScript, Python, Django, Bootstrap, and React.", message);

  } else if (message.includes("project") || message.includes("projects")) {
    speak("I've worked on a food delivery app, a grocery website, chatbot website, and an AI portfolio website. Redirecting you now.", message);
    window.location.href = projectsUrl;

  } else if (message.includes("resume") || message.includes("cv")) {
    speak("Opening my resume now.", message);
    window.open(resumeUrl, "_blank"); // Opens the PDF in a new tab

  } else if (message.includes("contact") || message.includes("connect")) {
    speak("Sure! Redirecting you to the contact page.", message);
    window.location.href = contactUrl;

  } else if (message.includes("job") || message.includes("hire")) {
    speak("Thanks for your interest. You can connect with me through the contact page.", message);

  } else if (message.includes("skills") || message.includes("technologies") || message.includes("tech stack")) {
    speak("I specialize in JavaScript, Python, Django, React, and more. You can find more details on the About page.", message);

  } else if (message.includes("about")) {
    speak("Sure! I'm a passionate web developer with experience in building responsive and interactive websites.", message);
    window.location.href = "{% url 'about' %}"; // Ensure 'about' is a valid URL name in Django

  } else if (message.includes("email") || message.includes("reach")) {
    speak("You can email me directly at sandhya.kumari.ds.2022@mitmeerut.ac.in.", message);

  } else if (message.includes("available") || message.includes("freelance") || message.includes("availability")) {
    speak("Yes, I'm currently available for freelance and full-time opportunities.", message);

  } else if (message.includes("services") || message.includes("offer")) {
    speak("I offer services like Full stack development, Frontend development, Backend development, and AI & Machine Learning.", message);

  } else if (message.includes("location") || message.includes("based")) {
    speak("I'm currently based in Meerut, Uttar Pradesh, but I work remotely with clients worldwide.", message);

  } else if (message.includes("thanks") || message.includes("thank you")) {
    speak("You're welcome! Let me know if there's anything else I can help you with.", message);

  } else if (message.includes("help") || message.includes("support")) {
    speak("Sure, let me know what you need help with. You can also visit the contact page for more options.", message);

  } else if (message.includes("experience")) {
    speak("I'm currently in my final year of B.Tech and have completed a Full Stack Development internship at Eduskills.", message);

  } else if (message.includes("education") || message.includes("degree")) {
    speak("I'm pursuing a B.Tech degree in Data Science and currently in my final year.", message);

  } else if (message.includes("internship") || message.includes("intern")) {
    speak("Yes, I completed a Full Stack Development internship with Eduskills. It was a great experience building real-world web applications.", message);

  } else if (message.includes("fresher")) {
    speak("Yes, I'm a fresher currently exploring job opportunities in web development.", message);

  } else if (message.includes("goals") || message.includes("future")) {
    speak("I'm aiming to become a skilled full-stack developer and work on innovative web projects.", message);

  } else if (message.includes("why hire") || message.includes("strength")) {
    speak("I'm passionate, quick to learn, and eager to contribute to real-world projects.", message);

  } else if (message.includes("hobby") || message.includes("free time")) {
    speak("In my free time, I enjoy coding, reading tech blogs, and exploring new tools in web development.", message);

  } else if (message.includes("certification") || message.includes("certificate")) {
    speak("Yes, I have completed certifications in Full Stack Development and AI & Machine Learning. Redirecting you to the certificates page.", message);
    window.location.href = certificatesUrl;

  } else if (message.includes("language") || message.includes("speak")) {
    speak("I speak English and Hindi fluently, which helps in collaborating effectively.", message);

  } else {
    speak("Sorry, I didn‚Äôt understand that. Try asking about resume, projects, or contact.", message);
  }
}

function speakFromMic() {
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = 'en-US';
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  recognition.onresult = function(event) {
    const spokenText = event.results[0][0].transcript;
    document.getElementById("userInput").value = spokenText;
    handleMessage();
  };

  recognition.onerror = function(event) {
    speak("Sorry, I couldn't hear you clearly.");
  };

  recognition.start();
}

window.addEventListener("load", function () {
  if (!sessionStorage.getItem("assistantGreeted")) {
    speak("Hello, I am Sandy, your virtual assistant.");
    sessionStorage.setItem("assistantGreeted", "true");
  }
});

</script>

</body>
</html>
